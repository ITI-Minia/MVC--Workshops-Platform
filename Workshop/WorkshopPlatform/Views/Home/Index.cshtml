@{
    ViewData["Title"] = "Home";
}

<div class="home--page">
    <div class="slid">
        <div id="carouselExampleIndicators"
             class="carousel slide"
             data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators"
                    data-slide-to="0"
                    class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div class="main main-one">
                        <div class="main-3">
                            <div class="slider--header">
                                <h1>We Can Come To You Any Where</h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="main main-two">
                        <div class="main-3">
                            <h1>WE Can Delivere You To Any Car WorkShop In Any Where</h1>
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="main">
                        <div class="main-3">
                            <h1>The First Web Site That Provides This Service in Egypt</h1>
                        </div>
                    </div>
                </div>
            </div>
            <a class="carousel-control-prev"
               href="#carouselExampleIndicators"
               role="button"
               data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next"
               href="#carouselExampleIndicators"
               role="button"
               data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    <div id="service">
        <header>
            <h1>Ser<span style="color: #d89216">vice</span></h1>
        </header>
        <div class="service--type">
            <div class="service--emergancy">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 col-12">
                            <img src="~/imgs/emergancy.svg" />
                        </div>
                        <div class="col-md-6 col-12">
                            <div class="service--emergancy--content">
                                <ul class="service--emergancy--items">
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> If You Have Accident Don't
                                        worry Call Us.
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> Repair All Faults In Your
                                        Place .
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> We can Take You TO Any car
                                        workShop.
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> Come To You Any Where.
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> We Can connet YOu To Any car
                                        workshop.
                                    </li>
                                    <div style="text-align: center; margin-top: 10px">
                                        <button class="btn emergancy--btn"
                                                name="location"
                                                id="geoloc"
                                                class="form-control">
                                            emergancy
                                        </button>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="requist--repair">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 col-12">
                            <div class="service--emergancy--content">
                                <ul class="service--emergancy--items">
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> If You Have Accident Don't
                                        worry Call Us.
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> Repair All Faults In Your
                                        Place .
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> We can Take You TO Any car
                                        workShop.
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> Come To You Any Where.
                                    </li>
                                    <li class="service--emergancy--item">
                                        <i class="fas fa-wrench"></i> We Can connet YOu To Any car
                                        workshop.
                                    </li>
                                    <div style="text-align: center; margin-top: 10px">
                                        <a asp-controller="Workshops" asp-action="Index">
                                            <button class="btn emergancy--btn">requist rebair</button>
                                        </a>
                                    </div>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6 col-12">
                            <img src="~/imgs/repair.jpg" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="wrapper">
        <div class="main">
            <div id="location-pick" class="hidden">
                <h3 class="text-center text-dark my-3">
                    Choose location
                    <button class="btn btn-danger" id="Done">Done</button>
                    <i class="fas fa-times-circle"
                       id="close_map"
                       style="float: right; margin-right: 50px"></i>
                </h3>

                <div id="map_collection">
                    <div id="map"
                         class="leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom"
                         tabindex="0"
                         style="position: relative; outline: none"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        var lat;
        var lang;
        var marker;
        var City;
        function getCoordintes() {
            var options = {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0,
            };

            function success(pos) {
                var crd = pos.coords;
                lat = crd.latitude.toString();
                lang = crd.longitude.toString();
                var coordinates = [lat, lang];
                console.log(`Latitude: ${lat}, Longitude: ${lang}`);
                getCity(coordinates);
                return;
            }

            function error(err) {
                console.warn(`ERROR(${err.code}): ${err.message}`);
            }

            navigator.geolocation.getCurrentPosition(success, error, options);
        }

        function getCity(coordinates) {
            var xhr = new XMLHttpRequest();
            lat = coordinates[0];
            lang = coordinates[1];
            xhr.open(
                "GET",
                `https://us1.locationiq.com/v1/reverse.php?key=pk.37f5b4435e10b85b679efcb0cbeb96c7&lat=` +
                lat +
                "&lon=" +
                lang +
                "&format=json",
                true
            );
            xhr.send();
            xhr.onreadystatechange = processRequest;
            xhr.addEventListener("readystatechange", processRequest, false);

            function processRequest(e) {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response = JSON.parse(xhr.responseText);
                    City = response.address;
                    console.log(City);
                    return;
                }
            }
        }

        getCoordintes();

        $("#geoloc").click(function () {
            $("#location-pick").removeClass("hidden");

            var mymap = L.map("map", {
                center: [lat, lang],
                zoom: 20,
            });

            L.tileLayer(
                "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibW9oYW1lZGFobWVkMDAiLCJhIjoiY2tnbXN3ZGcxMG9jYjJxbzE2Mjl4aHZidyJ9.4l4Ypb2qRyuNOyHrdmWUcw",
                {
                    id: "mapbox/streets-v11",
                    accessToken:
                        "pk.eyJ1IjoibW9oYW1lZGFobWVkMDAiLCJhIjoiY2tnbXN3ZGcxMG9jYjJxbzE2Mjl4aHZidyJ9.4l4Ypb2qRyuNOyHrdmWUcw",
                }
            ).addTo(mymap);

            mymap.addControl(
                new L.Control.Search({
                    url: "https://nominatim.openstreetmap.org/search?format=json&q={s}",
                    jsonpParam: "json_callback",
                    propertyName: "display_name",
                    propertyLoc: ["lat", "lon"],
                    marker: L.circleMarker([0, 0], { radius: 30 }),
                    autoCollapse: true,
                    autoType: false,
                    minLength: 2,
                })
            );

            marker = new L.marker([lat, lang]).addTo(mymap);

            function onMapClick(e) {
                lat = e.latlng.lat;
                lang = e.latlng.lng;
                if (marker) {
                    mymap.removeLayer(marker);
                }
                marker = new L.Marker(e.latlng).addTo(mymap);
                getCity([lat, lang]);
            }

            mymap.on("click", onMapClick);
        });

        $("#close_map").click(function () {
            $("#location-pick").addClass("hidden");
        });

        $("#Done").click(function () {
            var government = City.state;
            var city = City.town;
            var street = City.road;
            console.log(government, city, street);
            window.location.assign(
                `/Workshops/Emergacy/?Government=${government}&City=${city}&Street=${street}`
            );
        });
    </script>
}